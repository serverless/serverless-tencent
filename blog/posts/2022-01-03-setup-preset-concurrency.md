---
title: 如何快速为腾讯云云函数配置合适的预置并发数量
description: 可以在腾讯云使用基于云函数自身的并发请求数据，快速为云函数计算出一个合适的预置并发配置的数量
date: 2022-01-03
layout: Post
authors:
  - Zong Meng
category:
  - guides-and-tutorials
---

本文主要内容：

1. 什么是云函数预置并发？为什么要设置预置并发？
2. 设置预置并发的原则是什么？
3. 设置预置并发可以达到的预期是什么？
4. 如何使用本文提供的计算脚本快速计算出合适的预置并发数量

## 什么是云函数预置并发？ 为什么要设置预置并发？

### 什么是云函数预置并发?

腾讯云云函数预置并发功能是腾讯云提供的一种支持并发实例按照配置预先启动，防止云函数平台主动回收实例，尽可能保证当有并发请求来临时有对应数量的实例可以进行请求处理的功能。

### 为什么要设置预置并发?

1. 预置并发可以保持函数的存活，不主动被云函数平台回收，保证可以快速的处理请求
2. 可预先进行计算资源的准备， 降低冷启动、运行环境初始化以及业务代码初始化引起的耗时

## 设置预置并发的原则

1. 设置适合云函数请求量的预置并发数量。
   云函数配置了预置并发之后，没有被请求使用到的预置并发被称为**闲置预置并发**。预置并发会对限制预置并发实例进行费用收取，对使用中的实例进行弹性收费。所以说如果我们配置了大量的预置并发，但是云函数实际的并发请求量并不大，那我们会产生大量的**闲置预置并发费用**。可以参考腾讯云官方的[计费示例](https://cloud.tencent.com/document/product/583/12285#.E9.A2.84.E7.BD.AE.E5.B9.B6.E5.8F.91.E9.97.B2.E7.BD.AE.E8.B4.B9.E7.94.A8)
2. 如果一个云函数的请求在一天之中的不同时间段内起伏较大，比如工作时间段并发请求量大，在凌晨请求量小。可以考虑使用腾讯云提供的**定时预置**[功能](https://cloud.tencent.com/document/product/583/63698), 可以在低请求量的时间段动态调整预置并发数量，减少限制预置并发的费用。

## 设置预置并发的预期效果是什么？

1. 减少因为云函数冷启动问题带来的请求失败，请求耗时过长的问题
2. 不会产生过多的**闲置预置并发**费用，可以动态的为云函数配置一个相对合理的预置并发数量

## 使用**Analytics-concurrency**计算脚本为云函数快速计算相对合适的预置并发数量

为了帮助用户得到云函数的一个相对合理的预置并发数量的配置，提供了方便的计算脚本: [Analytics-concurrency](https://github.com/serverless-components/Analytics-concurrency). 使用此脚本，用户只需要对基本的数据资料进行填充，即可得到一个基于云函数并发请求量计算出来的**预置并发**的参考配置。 提供了:

1. 基于时间聚合区间的费用计算
2. 基于时间聚合区间的预置并发配置推荐
3. 以天为单位的费用总计
4. 基于时间粒度的费用计算

脚本的详细用法请参考代码文档， 这里有几点脚本的使用注意事项:

1. 脚本会基于用户在`resources` 中填充的 CSV 数据，计算所有数据在同一时间粒度的平均值
2. 用户放置在`resources` 中的 CSV 文件需要使用统一的时间粒度，比如 **1 分钟，5 分钟， 1 小时**
3. 用户可以自行选择可视化工具
4. 最后的费用计算结果保留的**小数点后三位**
5. 此脚本提供的是基于云函数的并发请求量计算出来的客观结果，不保证可靠性和费用的一致性，**仅作为参考使用**。
